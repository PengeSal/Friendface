<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="data:image/jpeg;base64,{{ logo }}">
    <title>朋友的脸︱家</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            height: 200vh;
            overflow: hidden;
            background: #f0f2f5;
            font-family: Helvetica, arial;
        }

        .pfp{
            background: white;
            width: 100vw;
            height: 64px;
            font-size: 13px;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.3);
            top: 0;
            position: fixed;
            z-index: 999999999;
        }



        #search-form {
            display: flex;
            align-items: center;
            padding: 12px;
        }

        #search-input {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 16px;
            background: #f0f2f5;
            width: 200px; 
            padding: 10px;
            border: 2px solid #f0f2f5;
            color: black;
            border-radius: 0px 25px 25px 0px;
            outline: none;
            
        }

        #search-input::placeholder {
            color: #787a80;
        }

        #search-button {
            cursor: pointer;
            color: rgb(124, 127, 136);
            font-family: Helvetica, Arial, sans-serif;
            font-size: 26px;
            background: #f0f2f5;
            width: 40px;
            border: 3px solid #f0f2f5;
            border-radius: 25px 0px 0px 25px;
            outline: none; 
            text-align: right;
            height: 42px;
        }

    </style>
</head>

<body title="光荣归于共产党！！ GLORY TO CCP!!">

    <div style="width: 100vw; justify-content: center; display: flex; background-color: blue; height: 0px;">
        <div id="splash" style="float: right; z-index: 999999999999; background-color: white; 
        text-align: center; cursor: default; transition: transform 0.3s; border-radius: 15px; position: fixed; top: 0;
        line-height: 40px; color: #787a80;">{{ splashmessage }}</div>


<script>
    function repeat(){
        if (window.innerWidth < 1100) {
            document.getElementById('splash').style.transform = 'translate(14vh, -100px)';
        } else if (window.innerWidth < 1400) {
            document.getElementById('splash').style.transform = 'translate(14vh)';
        } else {
            document.getElementById('splash').style.transform = 'translate(0px)';
        }
    }
    setInterval(repeat, 50)
</script>
    </div>
    
    <div class="pfp">
        
        <img title="更改头像"
            id="uploadButton"
            style="width: 50px; height: 50px; cursor: pointer; padding: 7px 15px 8px 15px; float: right; border-radius: 50%; transition: filter 0.3s;"
            src="data:image/jpeg;base64,{{ profile_picture }}"
            alt=":("
            onmouseover="this.style.filter='brightness(60%)'"
            onmouseout="this.style.filter='brightness(100%)'"
        onclick="triggerFileInput()">

        
        <form id="accountform" action="/users/{{ user_id }}/posts" method="get">
            <div class="name" onclick="submitname()"  title="你的帐户" style="float: right; font-family: Helvetica, arial;  font-size: 20px;">
                <p id="yourname">{{ profile_text }}</p>
            </div>
        </form>





        
        <form id="accountform" action="/" method="post">
            <img title="朋友的脸 FACE FRIEND CHINA"


            class="uploadButton"
            style="width: 50px; height: 50px; cursor: pointer; padding: 7px 0px 0px 15px; float: left;"
            src="data:image/jpeg;base64,{{ logo }}"
            alt=":(">

            <div class="logo" onclick="" title="朋友的脸 FACE FRIEND CHINA" style="float: left; color: #0866ff; font-family: Helvetica, arial; cursor: pointer; padding: 0px 10px 2px 1px;">
                <div style="width: 130px;">
                <h1 style="transform: translate(0, -13px);">这朋友的脸</h1>
                <p style="transform: translate(4px, -33px); font-size: 16px;">Friendface China</p>
                </div>

                <script>
                    document.querySelector(".logo").onclick = function() {
                        window.location.href = "/home/feed";
                    }
                    document.querySelector(".uploadButton").onclick = function() {
                        window.location.href = "/home/feed";
                    }
                </script>
            </div>
        </form>


        
        <form id="search-form" action="/searchusers" method="get">
            <button type="submit" id="search-button">⌕</button>
            <input type="text" id="search-input" name="search" placeholder="搜索所有用户" style="padding: 10px 10px 10px 0px;" title="搜索朋友的面孔">
        </form>



        <script>
            function submitname() {
              document.getElementById('accountform').submit();
            }
          </script>


        <style>
            .name{
                padding: 1px 0px 0px 0px;
                font-size: 12px;
                color: rgb(124, 127, 136);
                float: right;
                cursor: pointer;
                
            }
            .name:hover{
                color: rgb(163, 165, 172);
            }
        </style>

    </div>

    <input type="file" id="fileInput" style="display: none">
    

    <script>
        // THIS CODE IS STOLEN AF
        // THIS CODE IS STOLEN AF
        // THIS CODE IS STOLEN AF
        // THIS CODE IS STOLEN AF
        // THIS CODE IS STOLEN AF
        // THIS CODE IS STOLEN AF
        
        function triggerFileInput() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function () {
            var fileInput = document.getElementById('fileInput');
            var file = fileInput.files[0];
            var reader = new FileReader();

            reader.onload = function (e) {
                var imageData = e.target.result.split(',')[1];
                sendImageData(imageData);
            };

            reader.readAsDataURL(file);
        });

        function sendImageData(imageData) {
            var xhr = new XMLHttpRequest();
            var url = '/home/feed';
            var data = 'imageData=' + encodeURIComponent(imageData);

            xhr.open('POST', url, true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log(xhr.responseText);

                    location.reload();
                }
            };

            xhr.send(data);
        }
    </script>

<div class="posts" style="height: calc(100% - 60px); position: absolute; background: #f0f2f5; width: 100vw; overflow: hidden; bottom: 0;">
    <div style="height: 2px; width: 100vw; background-color: #caccd0; z-index: 9999999999999999 !important;"></div>

        <style>
            .evenmainerbox2 {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50vw, calc(-50vh + 20px));
                display: flex;
                justify-content: center;
                width: 100vw;
                
            }
        </style>

        <div class="evenmainerbox2" id="thecodewasstolen">
                                                                            

            <div class="actualposts" style="transition: transform 0.3s; transform: translate(0, 12px); background-color: #f0f2f5; border-top: 20px solid #f0f2f5; max-width: 1280px; height: calc(100vh - 83px);">
                <div class="actualposts3" style="max-width: 1280px; background-color: #f0f2f5; transition: transform 0.3s; border-radius: 10px; height: calc(100vh - 100px); width: 100vw;
                position: relative; overflow-y: scroll; overflow-x: hidden;">


                    <div style="max-width: 720px; width: calc(100% - 30px); background-color: white; float: right; border-radius: 10px; margin-bottom: 15px;
                    border-bottom: 2px solid #caccd0; padding: 0 15px 0 15px; line-height: 15px; z-index: 999;"><h2 style="float: left;">你的 饲料</h2>

                    <p style="float: left; padding-left: 5px; font-size: 20px;" id="repliesamount"></p></div>
                    

                    <div id="aboutsection" style="width: calc(100% - 770px); position: sticky; top: 0; background-color: #f0f2f5; display: none;
                    transition: transform 0.3s; overflow: hidden; float: left;">
                        <div style="width: 100%; background-color: white; float: left; border-radius: 10px; max-height: calc(100vh - 190px);
                        border-bottom: 2px solid #caccd0; line-height: 15px; overflow: hidden;">
                            <h2 style="padding: 0 15px 0 15px;">关于</h2>
                            <hr width="1000px">
                            <textarea id="homeless" style="
                                margin-left: 13px; 
                                border: 0px solid red; color: black;
                                width: calc(100% - 100px);
                                resize: none; 
                                outline: none; 
                                background-color: white; 
                                font-family: Arial; 
                                font-size: 18px;
                                margin-top: 5px; 
                                margin-bottom: 12px; 
                                max-height: calc(100vh - 285px); height: auto;" 
                                
                            readonly ></textarea>

                            <style>
                                hr {  
                                    height: 2px;  
                                    background-color: #caccd0;  
                                    border: none;  
                                }  
                            </style>

                            <div id="everyday" onclick="{{ about }}" style="display: none;"></div>

                            <script>
                                function insertdesc(about) {
                                    about2 = about.replace(/_THISISALINEBREAK_/g, "\n").replace(/_THISISANAPOSTROPHE_/g, "'");

                                    document.getElementById('homeless').value = about2


                                    function loop() {
                                        var invite_text = document.getElementById("homeless");

                                        invite_text.style.height = (invite_text.scrollHeight - 4) + 'px';

                                        if (invite_text.value.length <= 90) {
                                            if (invite_text.value.includes("_THISISALINEBREAK_")) {
                                                console.log("nuh uh");
                                            } else {
                                                invite_text.style.height = "22px";
                                            }
                                        }

                                        invite_text.value = invite_text.value.replace(/_THISISALINEBREAK_/g, "\n");

                                        invite_text.style.height = 'auto';
                                        invite_text.style.height = invite_text.scrollHeight - 4 + "px";
                                    }

                                    setInterval(loop, 1);
                                    
                                    
                                }
                            </script>
                            
                        
                            
                    
                        </div>
                        <p style="color: #787a80; margin-top: 15px; margin-left: 10px; line-height: 35px;">Copyright © Friendface Corporation 2024</p>
                        <p style="color: #787a80; margin-top: 15px; margin-left: 10px; line-height: 35px; transform: translate(0, -29px);">"Based" in British Virgin Islands</p>
                        
                    </div>



                    <button id="clickme" style="display: none;" onclick="{{ displayposts }}"></button>

                    <div class="actualposts2" style="max-width: 750px; float: right; width: 100vw; height: calc(100vh - 100px); border-radius: 10px;">
                    </div>


                    <div id="everyday" onclick="{{ about }}" style="display: none;"></div>

                   
                    

                    <script>
                        window.onload = (event) => {
                            var splashContent = document.getElementById("splash").textContent.trim();

    
                            if (document.getElementById("splash").textContent == "Now in colour!!!\n") {
                                document.getElementById("splash").textContent = "GLORY CCP 现在有颜色了！！GLORY CCP"
                                document.getElementById("splash").style.background = "linear-gradient(to right, red, orange, yellow, green, blue, indigo, purple)";
                                document.getElementById("splash").style.fontWeight = "bold";
                                document.getElementById("splash").style.webkitBackgroundClip = "text";
                                document.getElementById("splash").style.webkitTextFillColor = "transparent";
                            } else {
                                var englishText = splashContent;
                                var chineseText = '';
                                var dictionary = {
                                    'a': '啊', 'b': '不', 'c': '吃', 'd': '的', 'e': '额', 'f': '凡', 'g': '个', 'h': '和', 'i': '爱', 'j': '家', 
                                    'k': '可', 'l': '了', 'm': '没', 'n': '你', 'o': '哦', 'p': '跑', 'q': '去', 'r': '人', 's': '是', 't': '天', 
                                    'u': '喂', 'v': '我', 'w': '为', 'x': '下', 'y': '有', 'z': '在', 
                                    '.': '。', ',': '，', '?': '？', '!': '！', ':': '：', ';': '；', "'": '‘', '"': '“', '(': '（', ')': '）', 
                                    '[': '【', ']': '】', '{': '｛', '}': '｝', '-': '—', '_': '＿', '/': '／', '\\': '＼', '|': '｜', 
                                    '+': '＋', '=': '＝', '*': '＊', '&': '＆', '^': '＾', '%': '％', '$': '＄', '#': '＃', '@': '＠', 
                                    '<': '＜', '>': '＞', '~': '～', '`': '｀', ' ': ' '
                                };

                                for (var i = 0; i < englishText.length; i++) {
                                    var charr = englishText.charAt(i).toLowerCase();
                                    if (charr in dictionary) {
                                        chineseText += dictionary[charr];
                                    } else {
                                        chineseText += charr;
                                    }
                                }

                                document.getElementById("splash").textContent = "GLORY CCP " + chineseText + " GLORY CCP"

                            }

                            document.getElementById('everyday').click();

                            function getAverageRGB(imgEl) {
                                var blockSize = 5,
                                    defaultRGB = {r:0,g:0,b:0}, 
                                    canvas = document.createElement('canvas'),
                                    context = canvas.getContext && canvas.getContext('2d'),
                                    data, width, height,
                                    i = -4,
                                    length,
                                    rgb = {r:0,g:0,b:0},
                                    count = 0;

                                if (!context) {
                                    return defaultRGB;
                                }

                                height = canvas.height = imgEl.naturalHeight || imgEl.offsetHeight || imgEl.height;
                                width = canvas.width = imgEl.naturalWidth || imgEl.offsetWidth || imgEl.width;

                                context.drawImage(imgEl, 0, 0);

                                try {
                                    data = context.getImageData(0, 0, width, height);
                                } catch(e) {
                                    return defaultRGB;
                                }

                                length = data.data.length;

                                while ( (i += blockSize * 4) < length ) {
                                    ++count;
                                    rgb.r += data.data[i];
                                    rgb.g += data.data[i+1];
                                    rgb.b += data.data[i+2];
                                }

                                rgb.r = ~~(rgb.r/count);
                                rgb.g = ~~(rgb.g/count);
                                rgb.b = ~~(rgb.b/count);

                                return rgb;

                            }


                            function reload(){
                                var image = document.getElementById('image');
                                var average = getAverageRGB(image);

                                var rgb = 'rgb(' + average.r + ',' + average.g + ',' + average.b + ', 0.6)';

                                var colour = document.getElementById('thecodewasstolen');
                                colour.style.background = 'linear-gradient(to top, white, white, white, white, white, white, ' + rgb + ')';
                            }
                            

                            
                            reload();
                            
                                var string = "github.com/pengesal/lan-messager\n"
                                if (document.getElementById("splash").textContent == string) {
                                    document.getElementById("splash").style.cursor = "pointer";
                                    document.getElementById("splash").onclick = function() {
                                        window.open("https://github.com/pengesal/lan-messager");
                            }}
                            if (document.getElementById("splash").textContent == "Now in colour!!!\n") {
                                document.getElementById("splash").style.width = "125px";
                                document.getElementById("splash").style.background = "linear-gradient(to right, red, orange, yellow, green, blue, indigo, purple)";
                                document.getElementById("splash").style.fontWeight = "bold";
                                document.getElementById("splash").style.paddingLeft = "none";
                                document.getElementById("splash").style.paddingRight = "none";
                                document.getElementById("splash").style.webkitBackgroundClip = "text";
                                document.getElementById("splash").style.webkitTextFillColor = "transparent";
                            }

                            document.querySelector(".actualposts3").style.overflowY = "hidden";
                        };

                        

                        window.onscroll = function(ev) {
                            if ((window.innerHeight + Math.round(window.scrollY)) >= document.documentElement.scrollHeight) {
                                document.querySelector(".actualposts3").style.overflowY = "scroll";
                            } else {
                                document.querySelector(".actualposts3").style.overflowY = "hidden";
                            }
                        };
                        function repeat() {
                            if (window.innerWidth < 950) {
                                document.getElementById('aboutsection').style.transform = 'translate(-500px)';
                            } else {
                                document.getElementById('aboutsection').style.transform = 'translate(0px)';
                            }
                            
                        }
                        setInterval(repeat, 50)

                        var increment = 0;

                        function displayposts(post_ids, names, messages, user_ids, profile_pictures, likes, dislikes, 
                            comments_amounts, photos, times, likers, dislikers, replying_to, your_id, firsttime) {

                            
        

                            var post_ids = post_ids.split("_SEPARATOR_");
                            var names = names.split("_SEPARATOR_");
                            var messages = messages.split("_SEPARATOR_");
                            var user_ids = user_ids.split("_SEPARATOR_");
                            var profile_pictures = profile_pictures.split("_SEPARATOR_");
                            var likes = likes.split("_SEPARATOR_");
                            var dislikes = dislikes.split("_SEPARATOR_");
                            var comments_amounts = comments_amounts.split("_SEPARATOR_");
                            var photos = photos.split("_SEPARATOR_");
                            var times = times.split("_SEPARATOR_");
                            var likers = likers.split("_SEPARATOR_");
                            var dislikers = dislikers.split("_SEPARATOR_");
                            var replying_to = replying_to.split("_SEPARATOR_");
                            var your_id = your_id
                            var firsttime = firsttime

                            console.log("NAMES: " + names[1]);


                            if (typeof names[1] === "undefined") {
                                no_posts();
                            }; 

                            


                            function no_posts() {               
                                var newDiv2 = document.createElement('div');
                                var paragr = document.createElement('p');

                                newDiv2.style.backgroundColor = "#f0f2f5";
                                newDiv2.style.borderRadius = "10px";
                                newDiv2.style.maxWidth = "746px";
                                newDiv2.style.width = "100vh";
                                newDiv2.style.border = "2px solid #caccd0";   
                                newDiv2.style.height = "100px"; 
                                newDiv2.style.textAlign = "center"; 
                                
                                newDiv2.className = "maggiemae";

                                paragr.textContent = "This one for real ass ogs only";
                                paragr.style.transform = "translate(0, 30px)"; 
                                paragr.style.color = "#787a80"; 
                                paragr.style.lineHeight = "0";

                                document.querySelector(".actualposts2").appendChild(newDiv2);
                                document.querySelector(".maggiemae").appendChild(paragr);
                            }
                            
        
                            var arraylength = post_ids.length;

                            if (firsttime != "yes") {
                                arraylength = arraylength - 1
                            } else {
                                var post_ids = post_ids.reverse();
                                var names = names.reverse();
                                var messages = messages.reverse();
                                var user_ids = user_ids.reverse();
                                var profile_pictures = profile_pictures.reverse();
                                var likes = likes.reverse();
                                var dislikes = dislikes.reverse();
                                var comments_amounts = comments_amounts.reverse();
                                var photos = photos.reverse();
                                var times = times.reverse();
                                var likers = likers.reverse();
                                var dislikers = dislikers.reverse();
                                var replying_to = replying_to.reverse();
                            }


                            for (var i = 0; i < arraylength; i++) {
                                increment = increment + 1;

                                if (increment != 1) {
        
                                var newDiv = document.createElement('div');
                                var invite_text2 = document.createElement("P");
                                var link = document.createElement("button");
                                var invite_text = document.createElement("textarea");
                                var deletebutton = document.createElement("button");
        
                                var text = messages[i]
                                var text2 = names[i]
                                var time2 = times[i]
        
        
                                newDiv.style.fontSize = "20px";
                                newDiv.style.backgroundColor = 'white';
                                newDiv.className = "post" + increment;
                                newDiv.style.marginBottom = "15px";
                                newDiv.style.borderRadius = "10px";
                                newDiv.style.minHeight = "75px";
                                newDiv.style.borderBottom = "2px solid #caccd0";

                                newDiv.style.maxWidth = "750px";
                                newDiv.style.width = "100vw";

                                
                                newDiv.style.float = "right";
        
                                

                                function likepost(post_id, likestate) {
                                    var xhr = new XMLHttpRequest();

                                    var url = '/like/' + likestate + "/" + post_id;

                                    xhr.open('POST', url, true);

                                    xhr.onreadystatechange = function() {
                                        if (xhr.readyState == 4 && xhr.status == 200) {
                                            console.log(xhr.responseText);
                                            
                                        }
                                    };

                                    xhr.send("");
                                }

                                function dislikepost(post_id, likestate) {
                                    var xhr = new XMLHttpRequest();

                                    var url = '/dislike/' + likestate + "/" + post_id;

                                    xhr.open('POST', url, true);

                                    xhr.onreadystatechange = function() {
                                        if (xhr.readyState == 4 && xhr.status == 200) {
                                            console.log(xhr.responseText);
                                            
                                        }
                                    };

                                    xhr.send("");
                                }

                                function deletepost(post_id, increment) {
                                    document.querySelector(".post" + increment).style.display = "none";

                                    number = document.getElementById("repliesamount").textContent.replace(")", "").replace("(", "")
                                    number = parseInt(number)
                                    number = number - 1
                                    

                                    document.getElementById("repliesamount").textContent = "(" + number + ")"

                                    console.log(post_ids.length)
                                    console.log(post_ids)
                                    console.log(post_id.toString())

                                    post_ids = post_ids.filter(item => item !== post_id);


                                    if (post_ids.length == 1) {
                                        if (document.getElementById("newpostsarea").innerHTML.trim() === '') {

                                            no_posts();
                                        
                                        }
                                        
                                    }


                                    var xhr = new XMLHttpRequest();

                                    var url = '/delete/' + post_id;

                                    xhr.open('POST', url, true);

                                    xhr.onreadystatechange = function() {
                                        if (xhr.readyState == 4 && xhr.status == 200) {
                                            console.log(xhr.responseText);
                                            
                                        }
                                    };

                                    xhr.send("");

                                    


                                }

                                var div = document.createElement("div");
                                var image = document.createElement("img");
                                var time = document.createElement("p");
                                var actualimage = document.createElement("img");
                                var like = document.createElement("button");
                                var dislike = document.createElement("button");

                                like.className = "like" + increment;
                                dislike.className = "dislike" + increment;

                                var like2 = document.createElement("div");
                                var dislike2 = document.createElement("div");

                                var visit = document.createElement("button");

                                (function (index, user_id, photo, post_id, likes, dislikes, likers, dislikers, replying_to) {
                                    invite_text2.onclick = function () {
                                        window.location.href = "/users/" + user_id + "/posts";
                                    };

                                    link.onclick = function () {
                                        window.location.href = "/posts/" + replying_to
                                    };

                                    link.onmouseover = function() {
                                        document.querySelector(".link" + index).style.backgroundColor = "#c9daff";
                                    };

                                    link.onmouseout = function() {
                                        document.querySelector(".link" + index).style.backgroundColor = "#ebf1ff";
                                    };

                                    image.onclick = function () {
                                        window.location.href = "/users/" + user_id + "/posts";
                                    };

                                    actualimage.onclick = function () {
                                            function displayimage(){
                                    
                                            let scrollPosition = { top: 0, left: 0 };


                                            scrollPosition = {
                                                top: window.scrollY,
                                                left: window.scrollX
                                            };

                                            document.body.style.overflow = 'hidden';
                                            document.documentElement.style.overflow = 'hidden';

                                            window.scrollTo(scrollPosition.left, scrollPosition.top);

                                            




                                            event.stopPropagation(); 

                                            var existingdropdown = document.querySelector('.delete-dropdown');
                                            if (existingdropdown) {
                                                document.body.removeChild(existingdropdown);
                                            }

                                            


                                            var image = document.createElement("img");
                                            image.src = "data:image/jpeg;base64," + photo
                                            image.style.maxHeight = "calc(100vh - 214px)";
                                            image.style.maxWidth = "calc(100vw - 214px)";
                                            image.style.alignSelf = "center";
                                            image.style.transform = "translate(calc(50vw - 50%))"
                                            

                                            var button = document.createElement("button");
                                            button.style.borderRadius = "50%";
                                            button.style.backgroundColor = "white";
                                            button.style.border = "none";
                                            button.style.width = "50px";
                                            button.style.height = "50px";
                                            button.textContent = "✖";
                                            button.style.fontSize = "20px";
                                            button.style.paddingBottom = "3px";
                                            button.style.position = "absolute";
                                            button.style.margin = "25px";
                                            button.style.marginTop = "25px";

                                            button.onmouseout = function () {
                                                button.style.backgroundColor = "white";
                                            };

                                            button.onmouseover = function() {
                                                button.style.backgroundColor = "#caccd0";
                                            };


                                            var deletedropdown = document.createElement("div");
                                            deletedropdown.classList.add('delete-dropdown'); 
                                            deletedropdown.id = "deletedropdown"
                                            deletedropdown.style.position = "absolute";
                                            deletedropdown.style.top = window.pageYOffset + 64 + "px"; 
                                            deletedropdown.style.backgroundColor = "rgba(0, 0, 0, 0.75)";
                                            deletedropdown.style.zIndex = "9999";
                                            deletedropdown.style.height = "calc(100vh - 64px)";
                                            deletedropdown.style.width = "100vw";
                                            deletedropdown.style.backdropFilter = "blur(75px)"

                                            deletedropdown.style.display = "flex"; 
                                            
                                             

                                            document.body.appendChild(deletedropdown);

                                            deletedropdown.appendChild(image);
                                            deletedropdown.appendChild(button);

                                            

                                            
                                            

                                            
                                            deletedropdown.addEventListener('click', handleclickoutside);
                                            image.addEventListener('click', displayimage);

                                            


                                            function handleclickoutside(event) {
                                                let scrollPosition = { top: 0, left: 0 };
                                            
                                                document.body.style.overflow = '';
                                                document.documentElement.style.overflow = '';

                                                
                                            
                                                
                                                console.log("giggle")
                                                // if (!deletedropdown.contains(image)) {
                                                    document.body.removeChild(deletedropdown);
                                                    document.removeEventListener('click', handleclickoutside); 
                                                // }
                                            }

                                            function handleclickoutside2(event) {
                                                actualimage.click()
                                            }

                                            document.addEventListener('click', handleclickoutside);
                                            }
                                            displayimage();
                                            
                                        };

                                    visit.onmouseover = function() {
                                        document.querySelector(".visit" + index).style.backgroundColor = "#caccd0";
                                    };

                                    visit.onmouseout = function() {
                                        document.querySelector(".visit" + index).style.backgroundColor = "#f0f2f5";
                                    };

                                    deletebutton.onclick = function () {
                                        deletepost(post_id, index);
                                    };

                                    deletebutton.onmouseover = function() {
                                        document.querySelector(".deletebutton" + index).style.backgroundColor = "#caccd0";
                                    };

                                    deletebutton.onmouseout = function() {
                                        document.querySelector(".deletebutton" + index).style.backgroundColor = "#f0f2f5";
                                    };


                                    if (likers.split("_LIKERS_").includes(String(your_id))) {
                                        like.onclick = function() { 
                                            function blue() {
                                                likepost(post_id, "unlike");
                                                document.querySelector(".like2" + index).textContent = parseInt(likes) - 1;
                                                document.querySelector(".like" + index).style.backgroundColor = "#0866ff";
                                                document.querySelector(".like" + index).style.color = "white";

                                                document.querySelector(".like" + index).onclick = function() {
                                                    clickdislike();
                                                    likepost(post_id, "like");
                                                    document.querySelector(".like2" + index).textContent = parseInt(likes) + 1 - 1;
                                                    document.querySelector(".like" + index).style.backgroundColor = "#f0f2f5";
                                                    document.querySelector(".like" + index).style.color = "#787a80";
                                                    document.querySelector(".like" + index).onclick = function() {
                                                        
                                                        blue();
                                                    }
                                                }
                                            }
                                            blue();
                                        };
                                    } else {
                                        like.onclick = function() { 
                                            function grey() {
                                                clickdislike();
                                                likepost(post_id, "like");
                                                document.querySelector(".like2" + index).textContent = parseInt(likes) + 1;
                                                document.querySelector(".like" + index).style.backgroundColor = "#f0f2f5";
                                                document.querySelector(".like" + index).style.color = "#787a80";
                                                
                                                document.querySelector(".like" + index).onclick = function() {
                                                    likepost(post_id, "unlike");
                                                    document.querySelector(".like2" + index).textContent = parseInt(likes) + 1 - 1;
                                                    document.querySelector(".like" + index).style.backgroundColor = "#0866ff";
                                                    document.querySelector(".like" + index).style.color = "white";
                                                    document.querySelector(".like" + index).onclick = function() {
                                                        grey();
                                                    }
                                                }
                                            }
                                            grey();
                                        };
                                    }

                                    if (dislikers.split("_DISLIKERS_").includes(String(your_id))) {
                                        dislike.onclick = function() { 
                                            function disblue() {
                                                dislikepost(post_id, "undislike");
                                                document.querySelector(".dislike2" + index).textContent = parseInt(dislikes) - 1;
                                                document.querySelector(".dislike" + index).style.backgroundColor = "#0866ff"; 
                                                document.querySelector(".dislike" + index).style.color = "white";

                                                document.querySelector(".dislike" + index).onclick = function() {
                                                    clicklike();
                                                    dislikepost(post_id, "dislike");
                                                    document.querySelector(".dislike2" + index).textContent = parseInt(dislikes) + 1 - 1;
                                                    document.querySelector(".dislike" + index).style.backgroundColor = "#f0f2f5";
                                                    document.querySelector(".dislike" + index).style.color = "#787a80";
                                                    document.querySelector(".dislike" + index).onclick = function() {
                                                        
                                                        disblue();
                                                    }
                                                }
                                            }
                                            disblue();
                                        };
                                    } else {
                                        dislike.onclick = function() { 
                                            function disgrey() {
                                                clicklike();
                                                dislikepost(post_id, "dislike");
                                                document.querySelector(".dislike2" + index).textContent = parseInt(dislikes) + 1;
                                                document.querySelector(".dislike" + index).style.backgroundColor = "#f0f2f5"; 
                                                document.querySelector(".dislike" + index).style.color = "#787a80";

                                                document.querySelector(".dislike" + index).onclick = function() {
                                                    
                                                    dislikepost(post_id, "undislike");
                                                    document.querySelector(".dislike2" + index).textContent = parseInt(dislikes) + 1 - 1;
                                                    document.querySelector(".dislike" + index).style.backgroundColor = "#0866ff";
                                                    document.querySelector(".dislike" + index).style.color = "white";
                                                    document.querySelector(".dislike" + index).onclick = function() {
                                                        
                                                        disgrey();
                                                    }
                                                }
                                            }
                                            disgrey();
                                        };
                                    }
                                    function clicklike() {
                                        console.log("LIKE IS CLICKING");
                                            
                                            
                                        var likeElement = document.querySelector(".like" + index);
                                        var computedStyle = window.getComputedStyle(likeElement);
                                        var backgroundColor = computedStyle.backgroundColor;

                                        if (backgroundColor === "rgb(240, 242, 245)") {
                                            console.log("LIKE IS CLICKING");
                                            likeElement.click();
                                        }
                                    }

                                    function clickdislike() {
                                        console.log("DISLIKE IS CLICKING");
                                        var dislikeElement = document.querySelector(".dislike" + index);
                                        var computedStyle = window.getComputedStyle(dislikeElement);
                                        var backgroundColor = computedStyle.backgroundColor;

                                        if (backgroundColor === "rgb(240, 242, 245)") {
                                            console.log("DISLIKE IS CLICKING");
                                            dislikeElement.click();
                                        }
                                    }
                                    visit.onclick = function() { 
                                        window.location.href = "/posts/" + post_id
                                        
                                    };
                                })(increment, user_ids[i], photos[i], post_ids[i], likes[i], dislikes[i], likers[i], dislikers[i], replying_to[i]);
        
                                var user_id = user_ids[i];

                                invite_text2.textContent = text2
                                invite_text2.style.lineHeight = "0px";
                                invite_text2.style.transform = "translate(0, 5px)";
                                invite_text2.style.cursor = "pointer";
                                invite_text2.style.float = "left";
                                invite_text2.style.marginLeft = "10px";
                                invite_text2.style.width = "100%";

                                div.style.float = "left";
                                div.className = "left" + increment;




                                let dateTimeSplit = time2.split(" ");
                                let datePart = dateTimeSplit[0];
                                let timePart = dateTimeSplit[1];

                                let dateComponents = datePart.split("/");
                                let year = dateComponents[2];
                                let month = dateComponents[0];
                                let day = dateComponents[1];

                                time2 = year + "年" + month + "月" + day + "日 " + timePart;






                                time.textContent = time2;
                                time.style.marginLeft = "10px";
                                time.style.fontSize = "14px";
                                time.style.fontStyle = "italic";
                                time.style.color = "gray";
                                
                                function matchAndRemoveYoutubeUrls(text) {
                                    var p = /(?:https?:\/\/)?(?:m\.|www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?/g;
                                    var matches = [];
                                    var match;
                                    while ((match = p.exec(text)) !== null) {
                                        matches.push(match[1]);
                                    }
                                    var cleanedText = text.replace(p, '');
                                    return { matches: matches.length > 0 ? matches : false, cleanedText: cleanedText };
                                }

                                var result = matchAndRemoveYoutubeUrls(text);

                                match = result.matches[0]

                                if (match != undefined) {
                                    var video = document.createElement("iframe");

                                    video.src = "https://www.youtube.com/embed/" + match
                                    video.width = "750px";
                                    video.height = "422px"
                                    video.setAttribute('frameborder', '0');
                                    video.setAttribute('allowfullscreen', '');

                                }

                                console.log("Cleaned Text:", result.cleanedText);
                                                                    

                                invite_text.textContent = result.cleanedText.replace(/_THISISALINEBREAK_/g, "\n").replace(/_THISISANAPOSTROPHE_/g, "'").replace(/^\s+/, '');
                                invite_text.id = "invite_text";
                                invite_text.style.transform = "translate(0, -7px)";
                                invite_text.style.backgroundColor = "red";
                                invite_text.style.rows = "auto";
                                invite_text.style.marginLeft = "10px";
                                invite_text.style.border = "0px solid red";
                                invite_text.style.maxWidth = "100vw";
                                invite_text.style.width = "730px";
                                invite_text.style.resize = "none";
                                invite_text.style.outline = "none";
                                invite_text.style.backgroundColor = "white";
                                invite_text.readOnly = true;
                                invite_text.style.position = "relative";
                                invite_text.style.fontFamily = "Arial";
                                invite_text.style.fontSize = "16px";
                                invite_text.style.marginTop = "5px";
                                invite_text.style.height = "auto";

                                if (text.length <= 90) {
                                    invite_text.rows = "1";
                                }



                                image.style.fontSize = "16px";
                                image.style.width = "50px";
                                image.style.height = "50px";
                                image.style.cursor = "pointer"; 
                                image.style.marginLeft = "10px";
                                image.style.marginTop = "10px"; 
                                image.style.marginBottom = "10px"; 
                                image.style.float = "left"; 
                                image.style.borderRadius = "50%";
                                image.src = "data:image/jpeg;base64," + profile_pictures[i]

                                link.textContent = "回复。。。";
                                link.style.cursor = "pointer";
                                link.style.color = "#0866ff";
                                link.style.maxWidth = "730px";
                                link.style.width = "calc(100vw - 20px)";
                                link.style.background = "#ebf1ff";
                                link.style.marginBottom = "10px";
                                link.style.marginLeft = "10px";
                                link.style.border = "0px solid white";
                                link.style.borderRadius = "5px";
                                link.style.fontSize = "16px";
                                link.style.height = "30px";
                                link.className = "link" + increment

                                deletebutton.textContent = "删除";
                                deletebutton.style.float = "right";
                                deletebutton.className = "deletebutton" + increment
                                deletebutton.style.backgroundColor = "#f0f2f5";
                                deletebutton.style.border = "0px solid white";
                                deletebutton.style.color = "#787a80";
                                deletebutton.style.padding = "5px";
                                deletebutton.style.fontSize = "16px";
                                deletebutton.style.width = "85px";
                                deletebutton.style.marginTop = "20px";
                                deletebutton.style.marginRight = "10px";
                                deletebutton.style.borderRadius = "5px";
                                deletebutton.style.cursor = "pointer";
                                

                                actualimage.src = "data:image/jpeg;base64," + photos[i]
                                actualimage.style.width = "750px";
                                actualimage.style.marginTop = "5px";
                                actualimage.style.cursor = "pointer";
                                actualimage.style.marginBottom = "5px";
                                




                                var hr = document.createElement("hr");
                                hr.style.width = "750px";

                                var likesdiv = document.createElement("div");
                                
                                likesdiv.className = "likesdiv" + increment

                                

                                like.textContent = "喜欢 :)"
                                like.style.float = "left";
                                like.style.marginLeft = "8px";
                                like.style.border = "0px solid white";
                                like.style.color = "white";
                                like.style.padding = "3px";
                                like.style.fontSize = "13px";
                                like.style.borderRadius = "5px";
                                like.style.backgroundColor = "#0866ff";
                                like.style.width = "60px";
                                like.style.cursor = "pointer";
                                if (likers[i].split("_LIKERS_").includes(String(your_id))) {
                                    like.style.color = "#787a80";
                                    like.style.backgroundColor = "#f0f2f5";
                                } else {
                                    like.style.color = "white";
                                    like.style.backgroundColor = "#0866ff";
                                
                                }


                                dislike.textContent = "不喜欢 :(";
                                dislike.style.float = "left";
                                dislike.style.marginLeft = "5px";
                                dislike.style.border = "0px solid white";
                                dislike.style.color = "white";
                                dislike.style.padding = "3px";
                                dislike.style.fontSize = "13px";
                                dislike.style.borderRadius = "5px";
                                dislike.style.backgroundColor = "#0866ff";
                                dislike.style.width = "60px";
                                dislike.style.cursor = "pointer";
                                if (dislikers[i].split("_DISLIKERS_").includes(String(your_id))) {
                                    dislike.style.color = "#787a80";
                                    dislike.style.backgroundColor = "#f0f2f5";
                                } else {
                                    dislike.style.color = "white";
                                    dislike.style.backgroundColor = "#0866ff";
                                
                                }


                                like2.textContent = likes[i]
                                like2.style.float = "left";
                                like2.style.marginLeft = "8px";
                                like2.style.border = "0px solid white";
                                like2.style.color = "#787a80";
                                like2.style.padding = "3px";
                                like2.style.fontSize = "14px";
                                like2.style.width = "55px";
                                like2.className = "like2" + increment


                                dislike2.textContent = dislikes[i]
                                dislike2.style.float = "left";
                                dislike2.style.marginLeft = "5px";
                                dislike2.style.border = "0px solid white";
                                dislike2.style.color = "#787a80";
                                dislike2.style.padding = "3px";
                                dislike2.style.fontSize = "14px";
                                dislike2.style.width = "55px";
                                dislike2.className = "dislike2" + increment

                                visit.textContent = "去发帖";
                                visit.style.float = "left";
                                visit.style.marginLeft = "5px";
                                visit.style.border = "0px solid white";
                                visit.style.color = "#787a80";
                                visit.style.padding = "2px";
                                visit.style.fontSize = "14px";
                                visit.style.borderRadius = "5px";
                                visit.style.backgroundColor = "#f0f2f5";
                                visit.style.width = "calc(100% - 148px)"; 
                                visit.style.cursor = "pointer";
                                visit.className = "visit" + increment


                                document.querySelector(".actualposts2").appendChild(newDiv);
                                
                                document.querySelector(".post" + increment).appendChild(image);

                                if (parseInt(user_id) == parseInt(your_id)) {
                                    document.querySelector(".post" + increment).appendChild(deletebutton); 
                                }

                                document.querySelector(".post" + increment).appendChild(div);
                                document.querySelector(".left" + increment).appendChild(invite_text2);
                                document.querySelector(".left" + increment).appendChild(time);

                                if (replying_to[i] != "") {
                                    document.querySelector(".post" + increment).appendChild(link);
                                }

                                document.querySelector(".post" + increment).appendChild(invite_text);


                                if (match != undefined) {
                                    document.querySelector(".post" + increment).appendChild(video);

                                }

                                if (photos[i] != "") {
                                    document.querySelector(".post" + increment).appendChild(actualimage);
                                }

                                if (photos[i] == "" && match == undefined) {
                                    document.querySelector(".post" + increment).appendChild(hr);
                                }
                                document.querySelector(".post" + increment).appendChild(likesdiv);
                                document.querySelector(".likesdiv" + increment).appendChild(like);
                                document.querySelector(".likesdiv" + increment).appendChild(dislike);
                                document.querySelector(".likesdiv" + increment).appendChild(visit);
                                document.querySelector(".likesdiv" + increment).appendChild(like2);
                                document.querySelector(".likesdiv" + increment).appendChild(dislike2);
                                
                                
                                invite_text.style.height = (invite_text.scrollHeight) + 'px';



                                }
                            }
                            

                        }
                        document.getElementById("clickme").click()

                        var showmorebutton = document.createElement("button");

                        showmorebutton.onmouseover = function() {
                            showmorebutton.style.color = "#caccd0";
                        };

                        showmorebutton.onmouseout = function() {
                            showmorebutton.style.color = "#787a80";
                        };

                        showmorebutton.onclick = function () {
                            fetch('/get_more_posts')
                                .then(response => {
                                    if (!response.ok) {
                                    throw new Error('womp womp error not good');
                                    }
                                    return response.text();
                                })
                                .then(posts => {

                                    var dynamicFunction = new Function("displayposts(" + posts + ")");

                                    dynamicFunction();

                                    document.querySelector(".actualposts2").appendChild(document.getElementById("showmorebutton"));
                                    document.getElementById("showmorebutton").onmouseout();
                                    

                                })
                                .catch(error => {
                                    console.error('womp womp:', error);
                                });

                        };

                        showmorebutton.textContent = "显示更多帖子"
                        showmorebutton.id = "showmorebutton"
                        showmorebutton.style.fontSize = "20px";
                        showmorebutton.style.backgroundColor = 'white';
                        showmorebutton.style.marginBottom = "15px";
                        showmorebutton.style.borderRadius = "10px";
                        showmorebutton.style.height = "40px";
                        showmorebutton.style.border = "0px solid #caccd0";
                        showmorebutton.style.borderBottom = "2px solid #caccd0";
                        showmorebutton.style.cursor = "pointer";
                        showmorebutton.style.color = "#787a80";
                        showmorebutton.style.fontSize = "16px";
                        showmorebutton.style.marginBottom = "120px";

                        showmorebutton.style.maxWidth = "750px";
                        showmorebutton.style.width = "100vw";

                        
                        showmorebutton.style.float = "right";

                        document.querySelector(".actualposts2").appendChild(showmorebutton);
        
                    </script>
                </div>
            </div>
        </div>

    
    
</div>


<script>
    function updateposition() {
      const div1 = document.querySelector(".mainbox");
      const div2 = document.querySelector(".posts");
  
      const position = div1.getBoundingClientRect();
      const scrolltop = window.scrollY || document.documentElement.scrollTop;
  
      div2.style.top = `${position.bottom + scrolltop}px`;
    }
  
    updateposition();
  
    setInterval(updateposition, 0);
</script>


</body>
</html>



</body>






</html>
